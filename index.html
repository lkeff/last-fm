<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://ws.audioscrobbler.com https://freesound.org; object-src 'none'; base-uri 'self';">
  <title>Brass Stabs Finder - Professional Music Production Tool</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="app-container">
    <header class="app-header">
      <div class="header-content">
        <div class="logo-section">
          <h1 class="app-title">üé∫ Brass Stabs Finder</h1>
          <span class="app-subtitle">Professional Music Production Tool</span>
        </div>
        <div class="header-actions">
          <div class="security-status" id="security-status" title="Security Status">
            <span class="security-indicator secure" id="security-indicator"></span>
            <span class="security-text" id="security-text">Protected</span>
          </div>
          <button class="btn btn-primary" id="add-sample-btn" title="Add New Sample">
            <span class="icon">+</span> Add Sample
          </button>
          <div class="connection-status" id="connection-status">
            <span class="status-indicator"></span>
            <span class="status-text">Ready</span>
          </div>
        </div>
      </div>
      <nav class="tab-navigation">
        <button class="tab-btn active" data-tab="search" aria-selected="true">
          <span class="tab-icon">üîç</span>
          <span class="tab-label">Search & Browse</span>
        </button>
        <button class="tab-btn" data-tab="lastfm" aria-selected="false">
          <span class="tab-icon">üéµ</span>
          <span class="tab-label">Last.fm Discovery</span>
        </button>
        <button class="tab-btn" data-tab="library" aria-selected="false">
          <span class="tab-icon">üìö</span>
          <span class="tab-label">Sample Library</span>
        </button>
        <button class="tab-btn" data-tab="fiddle" aria-selected="false">
          <span class="tab-icon">‚ö°</span>
          <span class="tab-label">Electron Fiddle</span>
        </button>
      </nav>
    </header>

    <main class="app-main">

      <section class="tab-content active" id="search-tab" role="tabpanel" aria-labelledby="search-tab-btn">
        <div class="search-panel">
          <div class="search-header">
            <h2 class="section-title">Search Brass Stabs</h2>
            <div class="search-stats" id="search-stats">
              <span class="stat-item">Local: <span id="local-count">0</span></span>
              <span class="stat-item">Online: <span id="online-count">0</span></span>
            </div>
          </div>
          
          <!-- Normalization Controls -->
          <div class="normalization-controls">
            <div class="control-group">
              <label class="control-label">
                <input type="checkbox" id="show-normalized-values" checked>
                <span class="checkbox-custom"></span>
                <span class="control-text">Show Normalized Scores</span>
              </label>
              <button class="btn btn-ghost btn-small" id="normalization-help-btn" title="Learn about normalized values">
                <span class="btn-icon">‚ùì</span>
              </button>
            </div>
            <div class="control-group">
              <label class="control-label">
                <input type="radio" name="value-display" value="both" checked>
                <span class="radio-custom"></span>
                <span class="control-text">Both Raw & Normalized</span>
              </label>
              <label class="control-label">
                <input type="radio" name="value-display" value="raw">
                <span class="radio-custom"></span>
                <span class="control-text">Raw Values Only</span>
              </label>
              <label class="control-label">
                <input type="radio" name="value-display" value="normalized">
                <span class="radio-custom"></span>
                <span class="control-text">Normalized Only</span>
              </label>
            </div>
          </div>
          
          <div class="search-form">
            <div class="search-input-group">
              <input 
                type="text" 
                id="search-input" 
                class="search-input"
                placeholder="Search for brass stabs, genres, artists..."
                autocomplete="off"
                aria-label="Search query"
              >
              <button id="search-btn" class="btn btn-primary search-btn" aria-label="Search">
                <span class="btn-text">Search</span>
                <span class="btn-icon">üîç</span>
              </button>
              <button id="clear-search-btn" class="btn btn-secondary clear-btn" aria-label="Clear search">
                <span class="btn-icon">‚úï</span>
              </button>
            </div>
            
            <div class="search-filters">
              <div class="filter-group">
                <label class="filter-label">Search Sources:</label>
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" id="search-local" checked>
                    <span class="checkbox-custom"></span>
                    <span class="checkbox-text">Local Library</span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="search-online" checked>
                    <span class="checkbox-custom"></span>
                    <span class="checkbox-text">Freesound.org</span>
                  </label>
                </div>
              </div>
              
              <div class="filter-group">
                <label class="filter-label" for="genre-filter">Genre:</label>
                <select id="genre-filter" class="filter-select">
                  <option value="">All Genres</option>
                  <option value="hip-hop">Hip Hop</option>
                  <option value="jazz">Jazz</option>
                  <option value="funk">Funk</option>
                  <option value="soul">Soul</option>
                  <option value="disco">Disco</option>
                  <option value="electronic">Electronic</option>
                  <option value="orchestral">Orchestral</option>
                </select>
              </div>
              
              <div class="filter-group">
                <label class="filter-label" for="duration-filter">Duration:</label>
                <select id="duration-filter" class="filter-select">
                  <option value="">Any Duration</option>
                  <option value="short">Short (< 2s)</option>
                  <option value="medium">Medium (2-5s)</option>
                  <option value="long">Long (> 5s)</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div class="results-container">
          <div class="loading-overlay" id="search-loading">
            <div class="loading-spinner"></div>
            <div class="loading-text">Searching for brass stabs...</div>
          </div>
          
          <!-- Normalization Legend (will be populated by JavaScript) -->
          <div id="normalization-legend-container"></div>
          
          <div class="results-grid">
            <div class="results-section local-results">
              <div class="section-header">
                <h3 class="section-title">
                  <span class="section-icon">üíæ</span>
                  Local Library
                  <span class="result-count" id="local-result-count">(0)</span>
                </h3>
                <div class="section-actions">
                  <button class="btn btn-small" id="refresh-local-btn">Refresh</button>
                  <button class="btn btn-small" id="sort-local-btn">Sort</button>
                </div>
              </div>
              <div id="local-results" class="results-list" role="region" aria-label="Local search results"></div>
              <div class="empty-state" id="local-empty" style="display: none;">
                <div class="empty-icon">üìÅ</div>
                <div class="empty-text">No local samples found</div>
                <button class="btn btn-primary" id="add-first-sample-btn">Add Your First Sample</button>
              </div>
            </div>
            
            <div class="results-section online-results">
              <div class="section-header">
                <h3 class="section-title">
                  <span class="section-icon">üåê</span>
                  Freesound.org
                  <span class="result-count" id="online-result-count">(0)</span>
                </h3>
                <div class="section-actions">
                  <button class="btn btn-small" id="sort-online-btn">Sort</button>
                  <button class="btn btn-small btn-link external-link" data-url="https://freesound.org" id="visit-freesound-btn">
                    <span class="external-link-icon">üîó</span>
                    Visit Freesound
                  </button>
                </div>
              </div>
              <div id="online-results" class="results-list" role="region" aria-label="Online search results"></div>
              <div class="empty-state" id="online-empty" style="display: none;">
                <div class="empty-icon">üîç</div>
                <div class="empty-text">No online results found</div>
                <div class="empty-subtext">Try adjusting your search terms or filters</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="tab-content" id="lastfm-tab" role="tabpanel" aria-labelledby="lastfm-tab-btn">
        <div class="lastfm-panel">
          <div class="panel-header">
            <h2 class="section-title">Last.fm Music Discovery</h2>
            <div class="panel-description">
              Discover artists, tracks, and albums that commonly feature brass stabs
            </div>
          </div>
          
          <!-- Normalization Controls for Last.fm -->
          <div class="normalization-controls">
            <div class="control-group">
              <label class="control-label">
                <input type="checkbox" id="lastfm-show-normalized" checked>
                <span class="checkbox-custom"></span>
                <span class="control-text">Show Popularity Scores</span>
              </label>
              <span class="help-text" title="Normalized scores help compare popularity across different artists, tracks, and albums">
                üìä Scores are normalized to 0-100% for easy comparison
              </span>
            </div>
          </div>
          
          <div class="search-form">
            <div class="search-input-group">
              <input 
                type="text" 
                id="lastfm-search-input" 
                class="search-input"
                placeholder="Search artists, tracks, albums..."
                autocomplete="off"
                aria-label="Last.fm search query"
              >
              <button id="lastfm-search-btn" class="btn btn-primary search-btn">
                <span class="btn-text">Search Last.fm</span>
                <span class="btn-icon">üéµ</span>
              </button>
            </div>
            
            <div class="search-filters">
              <div class="filter-group">
                <label class="filter-label">Search Type:</label>
                <div class="radio-group">
                  <label class="radio-label">
                    <input type="radio" name="lastfm-type" value="artist" checked>
                    <span class="radio-custom"></span>
                    <span class="radio-text">Artists</span>
                  </label>
                  <label class="radio-label">
                    <input type="radio" name="lastfm-type" value="track">
                    <span class="radio-custom"></span>
                    <span class="radio-text">Tracks</span>
                  </label>
                  <label class="radio-label">
                    <input type="radio" name="lastfm-type" value="album">
                    <span class="radio-custom"></span>
                    <span class="radio-text">Albums</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="results-container">
          <div class="loading-overlay" id="lastfm-loading">
            <div class="loading-spinner"></div>
            <div class="loading-text">Searching Last.fm...</div>
          </div>
          
          <!-- Last.fm Normalization Legend Container -->
          <div id="lastfm-normalization-legend"></div>
          
          <div class="results-tabs">
            <button class="results-tab-btn active" data-results-tab="artists">
              Artists <span class="tab-count" id="artists-count">(0)</span>
            </button>
            <button class="results-tab-btn" data-results-tab="tracks">
              Tracks <span class="tab-count" id="tracks-count">(0)</span>
            </button>
            <button class="results-tab-btn" data-results-tab="albums">
              Albums <span class="tab-count" id="albums-count">(0)</span>
            </button>
          </div>
          
          <div class="results-content">
            <div class="results-tab-content active" id="artists-results">
              <div id="lastfm-artists" class="results-list" role="region" aria-label="Artist search results"></div>
            </div>
            <div class="results-tab-content" id="tracks-results">
              <div id="lastfm-tracks" class="results-list" role="region" aria-label="Track search results"></div>
            </div>
            <div class="results-tab-content" id="albums-results">
              <div id="lastfm-albums" class="results-list" role="region" aria-label="Album search results"></div>
            </div>
          </div>
        </div>
      </section>

      <section class="tab-content" id="library-tab" role="tabpanel" aria-labelledby="library-tab-btn">
        <div class="library-panel">
          <div class="panel-header">
            <h2 class="section-title">Sample Library Management</h2>
            <div class="panel-actions">
              <button class="btn btn-primary" id="import-samples-btn">
                <span class="btn-icon">üìÅ</span>
                Import Samples
              </button>
              <button class="btn btn-secondary" id="export-library-btn">
                <span class="btn-icon">üíæ</span>
                Export Library
              </button>
            </div>
          </div>
          
          <div class="library-stats">
            <div class="stat-card">
              <div class="stat-number" id="total-samples">0</div>
              <div class="stat-label">Total Samples</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="total-size">0 MB</div>
              <div class="stat-label">Total Size</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="total-duration">0:00</div>
              <div class="stat-label">Total Duration</div>
            </div>
          </div>
          
          <div class="library-filters">
            <div class="filter-group">
              <label class="filter-label" for="library-sort">Sort by:</label>
              <select id="library-sort" class="filter-select">
                <option value="name">Name</option>
                <option value="date">Date Added</option>
                <option value="size">File Size</option>
                <option value="duration">Duration</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label" for="library-view">View:</label>
              <select id="library-view" class="filter-select">
                <option value="grid">Grid</option>
                <option value="list">List</option>
              </select>
            </div>
          </div>
          
          <div class="library-content">
            <div id="library-samples" class="samples-grid"></div>
            <div class="empty-state" id="library-empty">
              <div class="empty-icon">üé∫</div>
              <div class="empty-text">Your sample library is empty</div>
              <div class="empty-subtext">Start by importing some brass stab samples</div>
              <button class="btn btn-primary" id="get-started-btn">Get Started</button>
            </div>
          </div>
        </div>
      </section>

      <section class="tab-content" id="fiddle-tab" role="tabpanel" aria-labelledby="fiddle-tab-btn">
        <div class="fiddle-panel">
          <div class="panel-header">
            <h2 class="section-title">Electron Fiddle Integration</h2>
            <div class="panel-description">
              Create and experiment with Electron code snippets for brass stabs and music production
            </div>
          </div>
          
          <div class="fiddle-status" id="fiddle-status">
            <div class="status-indicator"></div>
            <div class="status-text">Checking Electron Fiddle installation...</div>
          </div>
          
          <div class="templates-grid">
            <div class="template-category">
              <h3 class="category-title">Brass Stabs Templates</h3>
              <div class="template-cards">
                <div class="template-card" data-template="brass-stabs-basic">
                  <div class="template-icon">üé∫</div>
                  <div class="template-info">
                    <h4 class="template-title">Basic Brass Stabs</h4>
                    <p class="template-description">Load and play brass stab samples with basic audio processing</p>
                  </div>
                  <button class="btn btn-primary template-btn">Open in Fiddle</button>
                </div>
                
                <div class="template-card" data-template="brass-stabs-advanced">
                  <div class="template-icon">üéõÔ∏è</div>
                  <div class="template-info">
                    <h4 class="template-title">Advanced Audio Processing</h4>
                    <p class="template-description">Advanced brass stabs with effects, filters, and real-time processing</p>
                  </div>
                  <button class="btn btn-primary template-btn">Open in Fiddle</button>
                </div>
              </div>
            </div>
            
            <div class="template-category">
              <h3 class="category-title">API Integration Templates</h3>
              <div class="template-cards">
                <div class="template-card" data-template="lastfm-integration">
                  <div class="template-icon">üéµ</div>
                  <div class="template-info">
                    <h4 class="template-title">Last.fm Integration</h4>
                    <p class="template-description">Demonstrate Last.fm API integration for music discovery</p>
                  </div>
                  <button class="btn btn-primary template-btn">Open in Fiddle</button>
                </div>
                
                <div class="template-card" data-template="freesound-integration">
                  <div class="template-icon">üåê</div>
                  <div class="template-info">
                    <h4 class="template-title">Freesound API</h4>
                    <p class="template-description">Search and download samples from Freesound.org</p>
                  </div>
                  <button class="btn btn-primary template-btn">Open in Fiddle</button>
                </div>
              </div>
            </div>
            
            <div class="template-category">
              <h3 class="category-title">Custom Templates</h3>
              <div class="template-cards">
                <div class="template-card custom-template-card">
                  <div class="template-icon">‚ö°</div>
                  <div class="template-info">
                    <h4 class="template-title">Custom Template</h4>
                    <p class="template-description">Create your own Electron Fiddle template</p>
                  </div>
                  <button class="btn btn-secondary" id="create-custom-btn">Create Custom</button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="custom-template-editor" id="custom-template-editor" style="display: none;">
            <div class="editor-header">
              <h3>Custom Template Editor</h3>
              <div class="editor-actions">
                <button class="btn btn-secondary" id="save-template-btn">Save Template</button>
                <button class="btn btn-primary" id="open-custom-fiddle-btn">Open in Fiddle</button>
                <button class="btn btn-ghost" id="close-editor-btn">Close</button>
              </div>
            </div>
            
            <div class="editor-tabs">
              <button class="editor-tab-btn active" data-editor-tab="main">main.js</button>
              <button class="editor-tab-btn" data-editor-tab="renderer">renderer.js</button>
              <button class="editor-tab-btn" data-editor-tab="html">index.html</button>
              <button class="editor-tab-btn" data-editor-tab="preload">preload.js</button>
              <button class="editor-tab-btn" data-editor-tab="package">package.json</button>
            </div>
            
            <div class="editor-content">
              <div class="editor-tab-content active" id="main-editor-tab">
                <textarea id="main-editor" class="code-editor" placeholder="// Main process code..."></textarea>
              </div>
              <div class="editor-tab-content" id="renderer-editor-tab">
                <textarea id="renderer-editor" class="code-editor" placeholder="// Renderer process code..."></textarea>
              </div>
              <div class="editor-tab-content" id="html-editor-tab">
                <textarea id="html-editor" class="code-editor" placeholder="<!-- HTML content... -->"></textarea>
              </div>
              <div class="editor-tab-content" id="preload-editor-tab">
                <textarea id="preload-editor" class="code-editor" placeholder="// Preload script..."></textarea>
              </div>
              <div class="editor-tab-content" id="package-editor-tab">
                <textarea id="package-editor" class="code-editor" placeholder="// package.json content..."></textarea>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Modals and Overlays -->
    <div class="modal-overlay" id="sample-details-modal">
      <div class="modal-container">
        <div class="modal-header">
          <h2 class="modal-title" id="sample-name">Sample Details</h2>
          <button class="modal-close-btn" id="close-sample-modal" aria-label="Close modal">
            <span class="close-icon">‚úï</span>
          </button>
        </div>
        
        <div class="modal-content">
          <div class="sample-info-grid">
            <div class="sample-preview">
              <div class="waveform-container" id="sample-waveform">
                <div class="waveform-placeholder">üéµ Audio Waveform</div>
              </div>
              <div class="audio-controls" id="sample-player">
                <button class="play-btn" id="play-sample-btn" aria-label="Play sample">
                  <span class="play-icon">‚ñ∂Ô∏è</span>
                </button>
                <div class="progress-bar">
                  <div class="progress-fill"></div>
                </div>
                <div class="time-display">
                  <span class="current-time">0:00</span>
                  <span class="total-time">0:00</span>
                </div>
              </div>
            </div>
            
            <div class="sample-metadata" id="sample-details">
              <div class="metadata-section">
                <h4>File Information</h4>
                <div class="metadata-grid">
                  <div class="metadata-item">
                    <span class="metadata-label">Duration:</span>
                    <span class="metadata-value" id="sample-duration">-</span>
                  </div>
                  <div class="metadata-item">
                    <span class="metadata-label">File Size:</span>
                    <span class="metadata-value" id="sample-size">-</span>
                  </div>
                  <div class="metadata-item">
                    <span class="metadata-label">Format:</span>
                    <span class="metadata-value" id="sample-format">-</span>
                  </div>
                  <div class="metadata-item">
                    <span class="metadata-label">Sample Rate:</span>
                    <span class="metadata-value" id="sample-rate">-</span>
                  </div>
                </div>
              </div>
              
              <div class="metadata-section">
                <h4>Tags & Categories</h4>
                <div class="tags-container" id="sample-tags"></div>
              </div>
              
              <div class="metadata-section" id="online-sample-info" style="display: none;">
                <h4>Freesound Information</h4>
                <div class="metadata-grid">
                  <div class="metadata-item">
                    <span class="metadata-label">Author:</span>
                    <span class="metadata-value" id="sample-author">-</span>
                  </div>
                  <div class="metadata-item">
                    <span class="metadata-label">License:</span>
                    <span class="metadata-value" id="sample-license">-</span>
                  </div>
                  <div class="metadata-item">
                    <span class="metadata-label">Downloads:</span>
                    <span class="metadata-value" id="sample-downloads">-</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="btn btn-secondary" id="add-to-local-btn">
            <span class="btn-icon">üíæ</span>
            Add to Library
          </button>
          <button class="btn btn-primary" id="download-btn">
            <span class="btn-icon">‚¨áÔ∏è</span>
            Download
          </button>
          <button class="btn btn-ghost external-link" id="share-sample-btn">
            <span class="btn-icon">üîó</span>
            Share
          </button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="add-sample-modal">
      <div class="modal-container">
        <div class="modal-header">
          <h2 class="modal-title">Add New Sample</h2>
          <button class="modal-close-btn" id="close-add-modal" aria-label="Close modal">
            <span class="close-icon">‚úï</span>
          </button>
        </div>
        
        <div class="modal-content">
          <div class="upload-area" id="file-drop-zone">
            <div class="upload-icon">üìÅ</div>
            <div class="upload-text">
              <div class="upload-primary">Drop audio files here or click to browse</div>
              <div class="upload-secondary">Supports WAV, MP3, AIFF, FLAC, OGG (max 50MB)</div>
              <div class="upload-security-notice">
                <span class="security-icon">üîí</span>
                Files are scanned for security and stored locally with encryption
              </div>
            </div>
            <input type="file" id="file-input" multiple accept=".wav,.mp3,.aiff,.flac,.ogg" style="display: none;">
          </div>
          
          <div class="sample-form" id="sample-form" style="display: none;">
            <div class="form-group">
              <label class="form-label" for="sample-name-input">Sample Name:</label>
              <input type="text" id="sample-name-input" class="form-input" placeholder="Enter sample name...">
            </div>
            
            <div class="form-group">
              <label class="form-label" for="sample-genre-input">Genre:</label>
              <select id="sample-genre-input" class="form-select">
                <option value="">Select genre...</option>
                <option value="hip-hop">Hip Hop</option>
                <option value="jazz">Jazz</option>
                <option value="funk">Funk</option>
                <option value="soul">Soul</option>
                <option value="disco">Disco</option>
                <option value="electronic">Electronic</option>
                <option value="orchestral">Orchestral</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label" for="sample-tags-input">Tags:</label>
              <input type="text" id="sample-tags-input" class="form-input" placeholder="brass, stab, horn, trumpet... (comma separated)">
            </div>
            
            <div class="form-group">
              <label class="form-label" for="sample-description-input">Description:</label>
              <textarea id="sample-description-input" class="form-textarea" placeholder="Optional description..."></textarea>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="btn btn-secondary" id="cancel-add-btn">Cancel</button>
          <button class="btn btn-primary" id="save-sample-btn" disabled>
            <span class="btn-icon">üíæ</span>
            Add Sample
          </button>
        </div>
      </div>
    </div>

    <!-- Status Bar -->
    <footer class="status-bar">
      <div class="status-left">
        <span class="status-item" id="app-status">Ready</span>
        <span class="status-separator">|</span>
        <span class="status-item" id="search-status">No active searches</span>
        <span class="status-separator">|</span>
        <span class="status-item security-status-item" id="afk-status" title="AFK Guard Status">
          <span class="afk-indicator active" id="afk-indicator"></span>
          AFK Guard: Active
        </span>
      </div>
      <div class="status-right">
        <span class="status-item security-status-item" id="data-protection-status" title="Data Protection Status">
          <span class="protection-indicator secure" id="protection-indicator"></span>
          Data: Protected
        </span>
        <span class="status-separator">|</span>
        <span class="status-item" id="api-status">APIs: Ready</span>
        <span class="status-separator">|</span>
        <span class="status-item" id="version-info">v1.0.0</span>
      </div>
    </footer>

    <!-- Normalization Help Modal -->
    <div class="modal-overlay" id="normalization-help-modal">
      <div class="modal-container">
        <div class="modal-header">
          <h2 class="modal-title">Understanding Normalized Scores</h2>
          <button class="modal-close-btn" id="close-normalization-help" aria-label="Close modal">
            <span class="close-icon">‚úï</span>
          </button>
        </div>
        
        <div class="modal-content">
          <div class="help-section">
            <h3>What are Normalized Scores?</h3>
            <p>Normalized scores convert different types of data (like listener counts, file sizes, durations) to a consistent 0-100% scale. This makes it easy to compare values across different sources and data types.</p>
          </div>
          
          <div class="help-section">
            <h3>How It Works</h3>
            <div class="help-grid">
              <div class="help-item">
                <div class="help-icon low-value">üìä</div>
                <div class="help-content">
                  <h4>Low (0-33%)</h4>
                  <p>Values in the lower range of the dataset</p>
                </div>
              </div>
              <div class="help-item">
                <div class="help-icon medium-value">üìä</div>
                <div class="help-content">
                  <h4>Medium (34-66%)</h4>
                  <p>Values in the middle range of the dataset</p>
                </div>
              </div>
              <div class="help-item">
                <div class="help-icon high-value">üìä</div>
                <div class="help-content">
                  <h4>High (67-100%)</h4>
                  <p>Values in the upper range of the dataset</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="help-section">
            <h3>What Gets Normalized</h3>
            <ul class="help-list">
              <li><strong>Last.fm Data:</strong> Listener counts, play counts</li>
              <li><strong>Local Samples:</strong> File sizes, durations</li>
              <li><strong>Online Samples:</strong> File sizes, durations, download counts</li>
            </ul>
          </div>
          
          <div class="help-section">
            <h3>Benefits</h3>
            <ul class="help-list">
              <li>Easy comparison across different data types</li>
              <li>Quick identification of popular/large/long items</li>
              <li>Consistent visual representation</li>
              <li>Better decision making when browsing results</li>
            </ul>
          </div>
            
          <div class="help-section security-help-section">
            <h3>Security Features</h3>
            <div class="security-features-grid">
              <div class="security-feature">
                <div class="security-feature-icon">üîí</div>
                <div class="security-feature-content">
                  <h4>AFK Guard</h4>
                  <p>Automatically locks the session after 10 minutes of inactivity to protect your data</p>
                </div>
              </div>
              <div class="security-feature">
                <div class="security-feature-icon">üõ°Ô∏è</div>
                <div class="security-feature-content">
                  <h4>Link Protection</h4>
                  <p>All external links are validated for safety before opening</p>
                </div>
              </div>
              <div class="security-feature">
                <div class="security-feature-icon">üîê</div>
                <div class="security-feature-content">
                  <h4>Data Encryption</h4>
                  <p>Local data is encrypted and sensitive information is protected in logs</p>
                </div>
              </div>
            </div>
              
            <div class="security-best-practices">
              <h4>Security Best Practices</h4>
              <ul class="security-tips">
                <li>Keep the application updated for the latest security patches</li>
                <li>Only download samples from trusted sources</li>
                <li>Review external links before clicking</li>
                <li>Use strong, unique API keys for external services</li>
                <li>Regularly backup your sample library</li>
              </ul>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="btn btn-primary" id="got-it-btn">Got It!</button>
        </div>
      </div>
    </div>

    <!-- AFK Guard Lock Screen -->
    <div class="afk-lock-overlay" id="afk-lock-overlay" role="dialog" aria-labelledby="afk-lock-title" aria-modal="true">
      <div class="afk-lock-container">
        <div class="afk-lock-content">
          <div class="afk-lock-icon">üîí</div>
          <h2 class="afk-lock-title" id="afk-lock-title">Session Locked</h2>
          <p class="afk-lock-message">Your session has been locked due to inactivity. Click below to unlock and continue.</p>
          <div class="afk-lock-time" id="afk-lock-time">Locked at: --:--</div>
          <button class="btn btn-primary afk-unlock-btn" id="afk-unlock-btn" aria-label="Unlock session">
            <span class="btn-icon">üîì</span>
            Unlock Session
          </button>
        </div>
      </div>
    </div>

    <!-- Session Timeout Warning -->
    <div class="timeout-warning" id="timeout-warning" role="alert" aria-live="assertive">
      <div class="timeout-warning-content">
        <div class="timeout-warning-icon">‚è∞</div>
        <div class="timeout-warning-text">
          <div class="timeout-warning-title">Session will lock soon</div>
          <div class="timeout-warning-message">Your session will be locked in <span id="timeout-countdown">60</span> seconds due to inactivity.</div>
        </div>
        <div class="timeout-warning-actions">
          <button class="btn btn-small btn-primary" id="extend-session-btn">Stay Active</button>
          <button class="btn btn-small btn-ghost" id="dismiss-warning-btn">Dismiss</button>
        </div>
      </div>
    </div>

    <!-- External Link Confirmation Modal -->
    <div class="modal-overlay" id="external-link-modal">
      <div class="modal-container">
        <div class="modal-header">
          <h2 class="modal-title">External Link Warning</h2>
          <button class="modal-close-btn" id="close-external-link-modal" aria-label="Close modal">
            <span class="close-icon">‚úï</span>
          </button>
        </div>
        
        <div class="modal-content">
          <div class="external-link-warning">
            <div class="warning-icon">‚ö†Ô∏è</div>
            <div class="warning-content">
              <h3>You are about to visit an external website</h3>
              <p class="external-url" id="external-url-display">https://example.com</p>
              <div class="security-assessment" id="security-assessment">
                <div class="assessment-item">
                  <span class="assessment-icon safe">‚úÖ</span>
                  <span class="assessment-text">Domain is on our trusted list</span>
                </div>
              </div>
              <p class="warning-message">Always verify that external links are safe before proceeding. Be cautious of suspicious URLs or unexpected redirects.</p>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="btn btn-secondary" id="cancel-external-link-btn">Cancel</button>
          <button class="btn btn-primary" id="proceed-external-link-btn">
            <span class="btn-icon">üîó</span>
            Open Link
          </button>
        </div>
      </div>
    </div>

    <!-- Security Event Notifications -->
    <div class="security-notifications" id="security-notifications" aria-live="polite">
      <!-- Security notifications will be dynamically inserted here -->
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>
  </div>

  <script src="renderer.js"></script>
  
  <!-- Initialize normalization controls -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Normalization help modal
      const helpBtn = document.getElementById('normalization-help-btn');
      const helpModal = document.getElementById('normalization-help-modal');
      const closeHelpBtn = document.getElementById('close-normalization-help');
      const gotItBtn = document.getElementById('got-it-btn');
      
      if (helpBtn && helpModal) {
        helpBtn.addEventListener('click', () => {
          helpModal.classList.add('active');
        });
        
        [closeHelpBtn, gotItBtn].forEach(btn => {
          if (btn) {
            btn.addEventListener('click', () => {
              helpModal.classList.remove('active');
            });
          }
        });
        
        // Close on overlay click
        helpModal.addEventListener('click', (e) => {
          if (e.target === helpModal) {
            helpModal.classList.remove('active');
          }
        });
      }
      
      // Normalization display controls
      const showNormalizedCheckbox = document.getElementById('show-normalized-values');
      const lastfmShowNormalizedCheckbox = document.getElementById('lastfm-show-normalized');
      const valueDisplayRadios = document.querySelectorAll('input[name="value-display"]');
      
      // Handle normalization visibility toggle
      function updateNormalizationDisplay() {
        const showNormalized = showNormalizedCheckbox?.checked;
        const displayMode = document.querySelector('input[name="value-display"]:checked')?.value || 'both';
        
        // Update CSS classes on body to control visibility
        document.body.classList.toggle('hide-normalized', !showNormalized);
        document.body.classList.remove('show-raw-only', 'show-normalized-only', 'show-both');
        document.body.classList.add(`show-${displayMode.replace('_', '-')}`);
        
        // Update legend visibility
        const legends = document.querySelectorAll('.normalization-legend');
        legends.forEach(legend => {
          legend.style.display = showNormalized ? 'block' : 'none';
        });
      }
      
      // Add event listeners
      if (showNormalizedCheckbox) {
        showNormalizedCheckbox.addEventListener('change', updateNormalizationDisplay);
      }
      
      if (lastfmShowNormalizedCheckbox) {
        lastfmShowNormalizedCheckbox.addEventListener('change', () => {
          const showLastfmNormalized = lastfmShowNormalizedCheckbox.checked;
          const lastfmResults = document.getElementById('lastfm-normalization-legend');
          if (lastfmResults) {
            lastfmResults.style.display = showLastfmNormalized ? 'block' : 'none';
          }
        });
      }
      
      valueDisplayRadios.forEach(radio => {
        radio.addEventListener('change', updateNormalizationDisplay);
      });
      
      // Initialize display state
      updateNormalizationDisplay();
      
      // Security UI initialization
      initializeSecurityUI();
    });
    
    function initializeSecurityUI() {
      // AFK Guard UI
      const afkLockOverlay = document.getElementById('afk-lock-overlay');
      const afkUnlockBtn = document.getElementById('afk-unlock-btn');
      const timeoutWarning = document.getElementById('timeout-warning');
      const extendSessionBtn = document.getElementById('extend-session-btn');
      const dismissWarningBtn = document.getElementById('dismiss-warning-btn');
      
      // External Link Modal
      const externalLinkModal = document.getElementById('external-link-modal');
      const closeExternalLinkModal = document.getElementById('close-external-link-modal');
      const cancelExternalLinkBtn = document.getElementById('cancel-external-link-btn');
      const proceedExternalLinkBtn = document.getElementById('proceed-external-link-btn');
      
      // Handle external links
      document.addEventListener('click', (e) => {
        const externalLink = e.target.closest('.external-link');
        if (externalLink) {
          e.preventDefault();
          const url = externalLink.dataset.url || externalLink.href;
          if (url) {
            showExternalLinkWarning(url);
          }
        }
      });
      
      function showExternalLinkWarning(url) {
        const urlDisplay = document.getElementById('external-url-display');
        const securityAssessment = document.getElementById('security-assessment');
        
        if (urlDisplay) urlDisplay.textContent = url;
        
        // Simple security assessment (would be enhanced by security module)
        const trustedDomains = ['freesound.org', 'last.fm', 'github.com'];
        const domain = new URL(url).hostname;
        const isTrusted = trustedDomains.some(trusted => domain.includes(trusted));
        
        if (securityAssessment) {
          securityAssessment.innerHTML = `
            <div class="assessment-item">
              <span class="assessment-icon ${isTrusted ? 'safe' : 'warning'}">${isTrusted ? '‚úÖ' : '‚ö†Ô∏è'}</span>
              <span class="assessment-text">${isTrusted ? 'Domain is on our trusted list' : 'Domain requires verification'}</span>
            </div>
          `;
        }
        
        externalLinkModal.classList.add('active');
        
        // Store URL for proceed action
        proceedExternalLinkBtn.dataset.url = url;
      }
      
      // External link modal handlers
      [closeExternalLinkModal, cancelExternalLinkBtn].forEach(btn => {
        if (btn) {
          btn.addEventListener('click', () => {
            externalLinkModal.classList.remove('active');
          });
        }
      });
      
      if (proceedExternalLinkBtn) {
        proceedExternalLinkBtn.addEventListener('click', () => {
          const url = proceedExternalLinkBtn.dataset.url;
          if (url && window.api && window.api.openExternalSafe) {
            window.api.openExternalSafe(url);
          } else if (url) {
            window.open(url, '_blank');
          }
          externalLinkModal.classList.remove('active');
        });
      }
      
      // AFK Guard handlers
      if (afkUnlockBtn) {
        afkUnlockBtn.addEventListener('click', () => {
          if (window.api && window.api.afkGuard && window.api.afkGuard.requestUnlock) {
            window.api.afkGuard.requestUnlock();
          }
          afkLockOverlay.classList.remove('active');
          showSecurityNotification('Session unlocked successfully', 'success');
        });
      }
      
      if (extendSessionBtn) {
        extendSessionBtn.addEventListener('click', () => {
          if (window.api && window.api.afkGuard && window.api.afkGuard.reportActivity) {
            window.api.afkGuard.reportActivity();
          }
          timeoutWarning.classList.remove('active');
          showSecurityNotification('Session extended', 'info');
        });
      }
      
      if (dismissWarningBtn) {
        dismissWarningBtn.addEventListener('click', () => {
          timeoutWarning.classList.remove('active');
        });
      }
      
      // Security status updates
      function updateSecurityStatus() {
        const securityIndicator = document.getElementById('security-indicator');
        const securityText = document.getElementById('security-text');
        const afkIndicator = document.getElementById('afk-indicator');
        const protectionIndicator = document.getElementById('protection-indicator');
        
        // Update security indicators (would be enhanced by actual security module)
        if (securityIndicator && securityText) {
          securityIndicator.className = 'security-indicator secure';
          securityText.textContent = 'Protected';
        }
        
        if (afkIndicator) {
          afkIndicator.className = 'afk-indicator active';
        }
        
        if (protectionIndicator) {
          protectionIndicator.className = 'protection-indicator secure';
        }
      }
      
      function showSecurityNotification(message, type = 'info') {
        const container = document.getElementById('security-notifications');
        if (!container) return;
        
        const notification = document.createElement('div');
        notification.className = `security-notification ${type}`;
        notification.innerHTML = `
          <div class="notification-icon">${type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</div>
          <div class="notification-message">${message}</div>
          <button class="notification-close" aria-label="Close notification">‚úï</button>
        `;
        
        container.appendChild(notification);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
          if (notification.parentNode) {
            notification.remove();
          }
        }, 5000);
        
        // Manual close
        const closeBtn = notification.querySelector('.notification-close');
        if (closeBtn) {
          closeBtn.addEventListener('click', () => {
            notification.remove();
          });
        }
      }
      
      // Initialize security status
      updateSecurityStatus();
      
      // Simulate AFK timeout warning (would be controlled by actual AFK guard)
      function simulateTimeoutWarning() {
        let countdown = 60;
        const countdownElement = document.getElementById('timeout-countdown');
        
        const interval = setInterval(() => {
          countdown--;
          if (countdownElement) {
            countdownElement.textContent = countdown;
          }
          
          if (countdown <= 0) {
            clearInterval(interval);
            timeoutWarning.classList.remove('active');
            // Would trigger actual lock
          }
        }, 1000);
        
        timeoutWarning.classList.add('active');
        
        // Clear interval if warning is dismissed
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
              if (!timeoutWarning.classList.contains('active')) {
                clearInterval(interval);
                observer.disconnect();
              }
            }
          });
        });
        
        observer.observe(timeoutWarning, { attributes: true });
      }
      
      // Keyboard navigation for security elements
      document.addEventListener('keydown', (e) => {
        // Escape key closes modals
        if (e.key === 'Escape') {
          if (externalLinkModal.classList.contains('active')) {
            externalLinkModal.classList.remove('active');
          }
          if (timeoutWarning.classList.contains('active')) {
            timeoutWarning.classList.remove('active');
          }
        }
        
        // Enter key on AFK unlock
        if (e.key === 'Enter' && afkLockOverlay.classList.contains('active')) {
          afkUnlockBtn.click();
        }
      });
      
      // Accessibility: Focus management for lock screen
      const focusableElements = 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';
      
      function trapFocus(element) {
        const focusableContent = element.querySelectorAll(focusableElements);
        const firstFocusableElement = focusableContent[0];
        const lastFocusableElement = focusableContent[focusableContent.length - 1];
        
        element.addEventListener('keydown', (e) => {
          if (e.key === 'Tab') {
            if (e.shiftKey) {
              if (document.activeElement === firstFocusableElement) {
                lastFocusableElement.focus();
                e.preventDefault();
              }
            } else {
              if (document.activeElement === lastFocusableElement) {
                firstFocusableElement.focus();
                e.preventDefault();
              }
            }
          }
        });
        
        firstFocusableElement.focus();
      }
      
      // Apply focus trap to modals when they become active
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
            const target = mutation.target;
            if (target.classList.contains('active') && 
                (target.id === 'afk-lock-overlay' || target.id === 'external-link-modal')) {
              trapFocus(target);
            }
          }
        });
      });
      
      observer.observe(afkLockOverlay, { attributes: true });
      observer.observe(externalLinkModal, { attributes: true });
    }
  </script>
</body>
</html>
